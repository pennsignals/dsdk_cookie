name: test

on:
  push:
  schedule:
  - cron: "0 0 * * *"

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.9"]

    steps:
    - name: checkout
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.PAT }}

    - name: setup_python${{ matrix.python-version }}
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}

    - name: test
      env:
        GITHUB_TOKEN: ${{ secrets.PAT }}
      run: |
        pip install -U setuptools wheel pip
        pip install cruft pre-commit
        pre-commit run --all-files
        cruft create --no-input https://github.com/${{ github.repository }}
        cd servicecanary
        git config --global init.defaultBranch main
        git config --global user.email "pennsignals123@users.noreply.github.com"
        git config --global user.name "pennsignals123@users.noreply.github.com"
        git init .
        git add -A
        git commit -m 'Serivce canary'
        git push -u origin "https://pennsignals123:$GITHUB_TOKEN@github.com/pennsignals/servicecanary.git" HEAD:main -f -v
